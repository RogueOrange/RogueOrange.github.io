<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project · Gareth Coward</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body data-page="project-detail">
  <header class="topbar">
    <div class="nav-actions">
      <a class="text-link back-link" href="index.html">← Back to main page</a>
      <button class="menu-toggle" aria-label="Open navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </header>
  <div class="nav-drawer" aria-hidden="true">
    <div class="drawer-panel">
      <div class="drawer-head">
        <p class="eyebrow">Navigate</p>
        <button class="drawer-close" aria-label="Close navigation">×</button>
      </div>
      <div class="drawer-links">
        <a href="index.html#home">Home</a>
        <a href="index.html#projects">Highlights</a>
        <a href="projects.html">Projects</a>
        <a href="about.html">About page</a>
      </div>
    </div>
  </div>

  <div class="milestone-rail" aria-hidden="true">
    <div class="rail-line">
      <div class="rail-progress" id="rail-progress"></div>
    </div>
    <div class="rail-dots" id="milestone-dots"></div>
  </div>

  <main class="page-wrap" id="project-page">
    <section class="hero project-hero" id="project-hero">
      <div class="hero-copy">
        <p class="eyebrow" id="project-status">Project</p>
        <h1 id="project-title">Project title</h1>
        <p class="lede" id="project-subtitle">Subtitle</p>
        <div class="tags" id="project-tags"></div>
      </div>
      <div class="hero-panel">
        <div class="panel-title">In this project</div>
        <div class="panel-grid" id="project-spotlight"></div>
        <div class="inline-link">
          <a class="text-link" href="projects.html">Back to all projects →</a>
        </div>
      </div>
    </section>

    <section class="section project-media" id="project-media">
      <div class="media-figure" id="project-image" aria-hidden="true">Placeholder image</div>
      <div>
        <p class="eyebrow">Snapshot</p>
        <h2 id="media-title">Inside the build</h2>
        <p class="section-lede" id="media-copy">Placeholder details about the restoration imagery and highlights.</p>
      </div>
    </section>

    <section class="section" id="project-overview">
      <div class="section-head">
        <div>
          <p class="eyebrow">Overview</p>
          <h2 id="overview-title">Scope and story</h2>
          <p class="section-lede" id="overview-copy"></p>
        </div>
      </div>
      <div class="card-grid three" id="project-outcomes"></div>
    </section>

    <section class="section bordered" id="project-story">
      <div class="section-head">
        <div>
          <p class="eyebrow">Story</p>
          <h2 id="story-title">Restoration story</h2>
          <p class="section-lede" id="story-summary"></p>
        </div>
      </div>
      <div class="story-grid" id="story-body"></div>
    </section>

    <section class="section bordered" id="project-timeline">
      <div class="section-head">
        <div>
          <p class="eyebrow">Timeline</p>
          <h2>Key phases</h2>
          <p class="section-lede">Describe the milestones or phases that break down this project so readers can follow the flow.</p>
        </div>
      </div>
      <div class="timeline" id="project-phases"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="brand">
      <div class="brand-mark">GC</div>
      <div class="brand-text">
        <div class="brand-name">Gareth Coward</div>
      </div>
    </div>
    <div class="footer-links">
      <a href="index.html#home">Home</a>
      <a href="projects.html">Projects</a>
    </div>
    <p class="footnote">© 2024 Gareth Coward. Replace this with your preferred footer or attribution.</p>
  </footer>
  <script src="assets/js/projects-data.js"></script>
  <script>
    function buildDetailPage(project) {
      document.title = `${project.title} · Gareth Coward`;
      const status = document.getElementById('project-status');
      const title = document.getElementById('project-title');
      const subtitle = document.getElementById('project-subtitle');
      const tags = document.getElementById('project-tags');
      const spotlight = document.getElementById('project-spotlight');
      const overview = document.getElementById('overview-copy');
      const outcomes = document.getElementById('project-outcomes');
      const phases = document.getElementById('project-phases');
      const mediaTitle = document.getElementById('media-title');
      const mediaCopy = document.getElementById('media-copy');
      const mediaFigure = document.getElementById('project-image');
      const storyTitle = document.getElementById('story-title');
      const storySummary = document.getElementById('story-summary');
      const storyBody = document.getElementById('story-body');

      status.textContent = project.status;
      title.textContent = project.title;
      subtitle.textContent = project.subtitle;

      tags.innerHTML = '';
      project.tags.forEach((tag) => {
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.textContent = tag;
        tags.appendChild(chip);
      });

      spotlight.innerHTML = '';
      (project.spotlight || []).forEach((item) => {
        const card = document.createElement('div');
        card.className = 'panel-card';
        const text = document.createElement('p');
        text.className = 'panel-copy';
        text.textContent = item;
        card.appendChild(text);
        spotlight.appendChild(card);
      });

      overview.textContent = project.overview || project.description;

      mediaTitle.textContent = project.mediaTitle || 'Inside the build';
      mediaCopy.textContent = project.mediaCopy || 'Placeholder details about the restoration imagery and highlights.';
      if (project.image) {
        mediaFigure.style.backgroundImage = `linear-gradient(135deg, rgba(255, 107, 0, 0.2), rgba(255, 107, 0, 0.04)), url(${project.image})`;
      }
      mediaFigure.textContent = project.imageAlt || mediaFigure.textContent;

      outcomes.innerHTML = '';
      (project.outcomes || []).forEach((point) => {
        const card = document.createElement('article');
        card.className = 'card soft';
        const text = document.createElement('p');
        text.textContent = point;
        card.appendChild(text);
        outcomes.appendChild(card);
      });

      phases.innerHTML = '';
      (project.timeline || []).forEach((item, index) => {
        const step = document.createElement('div');
        step.className = 'step';

        const number = document.createElement('div');
        number.className = 'step-number';
        number.textContent = String(index + 1).padStart(2, '0');
        step.appendChild(number);

        const body = document.createElement('div');
        const heading = document.createElement('h3');
        heading.textContent = item.phase;
        const copy = document.createElement('p');
        copy.textContent = item.detail;
        body.appendChild(heading);
        body.appendChild(copy);

        step.appendChild(body);
        phases.appendChild(step);
      });

      const story = project.story || {};
      storyTitle.textContent = story.heading || 'Project story';
      storySummary.textContent = story.summary || project.description;
      storyBody.innerHTML = '';
      (story.paragraphs || []).forEach((paragraph) => {
        const card = document.createElement('article');
        card.className = 'card soft';
        const text = document.createElement('p');
        text.textContent = paragraph;
        card.appendChild(text);
        storyBody.appendChild(card);
      });

      buildMilestones(project.milestones);
    }

    function buildMilestones(milestones = []) {
      const dots = document.getElementById('milestone-dots');
      const progress = document.getElementById('rail-progress');
      if (!dots || !progress) return;

      const fallback = [
        { label: 'Hero', target: '#project-hero' },
        { label: 'Overview', target: '#project-overview' },
        { label: 'Story', target: '#project-story' },
        { label: 'Timeline', target: '#project-timeline' },
      ];

      const usable = (milestones.length ? milestones : fallback)
        .map((item) => ({ ...item, element: document.querySelector(item.target) }))
        .filter((item) => item.element);

      if (!usable.length) return;

      dots.innerHTML = '';
      usable.forEach((item) => {
        const dot = document.createElement('button');
        dot.className = 'milestone-dot';
        dot.dataset.target = item.target;
        dot.innerHTML = `<span class="dot"></span><span class="dot-label">${item.label}</span>`;
        dot.addEventListener('click', () => {
          item.element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        dots.appendChild(dot);
      });

      const updateActive = () => {
        const scrollTop = window.scrollY;
        const docHeight = document.body.scrollHeight - window.innerHeight;
        const percent = docHeight > 0 ? Math.min(1, scrollTop / docHeight) : 0;
        progress.style.height = `${percent * 100}%`;

        const midpoint = scrollTop + window.innerHeight / 2;
        let activeIndex = 0;
        usable.forEach((item, index) => {
          const rect = item.element.getBoundingClientRect();
          const top = rect.top + scrollTop;
          if (midpoint >= top - 80) {
            activeIndex = index;
          }
        });

        dots.querySelectorAll('.milestone-dot').forEach((dot, index) => {
          dot.classList.toggle('active', index === activeIndex);
        });
      };

      window.addEventListener('scroll', updateActive, { passive: true });
      window.addEventListener('resize', updateActive);
      updateActive();
    }

    function renderProjectDetail() {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('slug');
      const project = window.projectStore?.findProjectBySlug(slug);
      if (!project) {
        const container = document.getElementById('project-page');
        container.innerHTML = `
          <section class="section">
            <div class="section-head">
              <div>
                <p class="eyebrow">Not found</p>
                <h2>Project unavailable</h2>
                <p class="section-lede">That project couldn't be loaded. Please head back to the projects index.</p>
              </div>
            </div>
            <a class="text-link" href="projects.html">Return to projects →</a>
          </section>`;
        return;
      }

      buildDetailPage(project);
    }

    document.addEventListener('DOMContentLoaded', renderProjectDetail);
  </script>
</body>
</html>
